import{u as oe,D,G as ne,R as j,E as F,d as O,a as w,r as ae,g,o as s,c as u,w as r,k as q,b as S,h as b,j as C,F as $,s as G,U as _,I as X,_ as Y,K as se,f as k,z as B,V as z,L as le,M as ie,W as ce}from"./index-148fbec8.js";import{f as re}from"./format-7c130e46.js";function x(e){const t=oe(),{permissions:n}=t;return!!n.find(a=>a.includes(e))}function ue(e){return D.post({url:"/users/list",data:e})}function de(e){return D.delete({url:`/users/${e}`})}function pe(e){return D.post({url:"/users",data:e})}function fe(e,t){return D.patch({url:`/users/${e}`,data:t})}function ge(e,t){return D.post({url:`/${e}/list`,data:t})}function _e(e,t){return D.delete({url:`/${e}/${t}`})}function ye(e,t,n){return D.patch({url:`/${e}/${t}`,data:n})}function me(e,t){return D.post({url:`/${e}`,data:t})}const he=ne("system",{state:()=>({usersList:[],totalCount:0,pageList:[],pageTotalCount:0}),actions:{async usersListDataAction(e){const t=await ue(e);this.usersList=t.data.list,this.totalCount=t.data.totalCount},async deleteUserByIdAction(e){const t=await de(e);console.log(t),this.usersListDataAction({offset:0,size:10})},async newUserDataAction(e){const t=await pe(e);console.log(t),this.usersListDataAction({offset:0,size:10})},async editUserByIdAction(e,t){const n=await fe(e,t);console.log(n),this.usersListDataAction({offset:0,size:10})},async postPageListDataAction(e,t){const n=await ge(e,t);this.pageList=n.data.list,this.pageTotalCount=parseInt(n.data.totalCount)},async deletePageByIdAction(e,t){const n=await _e(e,t);console.log(n),this.postPageListDataAction(e,{offset:0,size:10}),j().fetchEntireRolesAction()},async editPageDataAction(e,t,n){const a=await ye(e,t,n);F({type:"success",message:a.data,duration:800}),console.log(a),this.postPageListDataAction(e,{offset:0,size:10}),j().fetchEntireRolesAction()},async newPageDataAction(e,t){const n=await me(e,t);console.log(n),F({type:"success",message:n.data,duration:800}),this.postPageListDataAction(e,{offset:0,size:10}),j().fetchEntireRolesAction()}}}),Z=he,Ce={class:"dialog-footer"},ve=O({__name:"page-modal",props:{modalConfig:null,otherInfo:null},setup(e,{expose:t}){const n=e,a=w(!1),h={};for(const d of n.modalConfig.formItems)h[d.prop]="";const l=ae(h),y=w(),R=w(!0),P=Z(),A=(d=!0,m)=>{if(a.value=!0,R.value=d,!d&&m){for(const v in l)l[v]=m[v];y.value=m}else{for(const v in l)l[v]="";y.value=null}},U=()=>{a.value=!1;let d=l;n.otherInfo&&(d={...d,...n.otherInfo}),!R.value&&y.value?P.editPageDataAction(n.modalConfig.pageName,y.value.id,d):P.newPageDataAction(n.modalConfig.pageName,d)};return t({setModelVisible:A}),(d,m)=>{const v=g("el-input"),N=g("el-date-picker"),T=g("el-option"),L=g("el-select"),E=g("el-form-item"),M=g("el-form"),I=g("el-button"),p=g("el-dialog");return s(),u(p,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=o=>a.value=o),title:R.value?e.modalConfig.header.newTitle:e.modalConfig.header.editTitle,width:"30%",center:""},{footer:r(()=>[q("span",Ce,[S(I,{onClick:m[0]||(m[0]=o=>a.value=!1)},{default:r(()=>[b("取消")]),_:1}),S(I,{type:"primary",onClick:U},{default:r(()=>[b("确认")]),_:1})])]),default:r(()=>[S(M,{model:l,"label-width":"80px",size:"large"},{default:r(()=>[(s(!0),C($,null,G(e.modalConfig.formItems,o=>(s(),C($,{key:o.prop},[o.isHidden?_("",!0):(s(),u(E,{key:0,label:o.label,prop:o.prop},{default:r(()=>[o.type==="input"?(s(),u(v,{key:0,modelValue:l[o.prop],"onUpdate:modelValue":c=>l[o.prop]=c,placeholder:o.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])):_("",!0),o.type==="date-picker"?(s(),u(N,{key:1,modelValue:l[o.prop],"onUpdate:modelValue":c=>l[o.prop]=c,type:"daterange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue","onUpdate:modelValue"])):_("",!0),o.type==="custom"?X(d.$slots,o.slotName,{key:2},void 0,!0):_("",!0),o.type==="select"?(s(),u(L,{key:3,modelValue:l[o.prop],"onUpdate:modelValue":c=>l[o.prop]=c,placeholder:o.placeholder,style:{width:"100%"}},{default:r(()=>[(s(!0),C($,null,G(o.options,c=>(s(),u(T,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):_("",!0)]),_:2},1032,["label","prop"]))],64))),128))]),_:3},8,["model"])]),_:3},8,["modelValue","title"])}}});const Ve=Y(ve,[["__scopeId","data-v-16f17692"]]),ke={class:"content"},we={key:0,class:"header"},De={class:"table"},Pe={key:1,class:"paging"},be=O({__name:"page-content",props:{contentConfig:null},emits:["newClick","editClick"],setup(e,{expose:t,emit:n}){const a=e,h=x(`${a.contentConfig.pageName}:create`),l=x(`${a.contentConfig.pageName}:delete`),y=x(`${a.contentConfig.pageName}:update`),R=x(`${a.contentConfig.pageName}:query`),P=Z(),A=w(1),U=w(10),d=w(a.contentConfig.isPagination);P.$onAction(({name:p,after:o})=>{o(()=>{(p==="deletePageByIdAction"||p==="editPageDataAction"||p==="newPageDataAction")&&(A.value=1)})}),L();const{pageList:m,pageTotalCount:v}=se(P),N=()=>{L()},T=()=>{L()};function L(p={}){if(!R)return;const o=U.value,c=(A.value-1)*o,Q={...{size:o,offset:c},...p};P.postPageListDataAction(a.contentConfig.pageName,Q)}const E=()=>{n("newClick")},M=p=>{ce.confirm("是否删除该条数据","删除操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{P.deletePageByIdAction(a.contentConfig.pageName,p),F({type:"success",message:"删除成功",duration:800})}).catch(()=>{})},I=p=>{n("editClick",p)};return t({fetchPageListDate:L}),(p,o)=>{var H,K,W,J;const c=g("el-button"),V=g("el-table-column"),Q=g("el-table"),ee=g("el-pagination");return s(),C("div",ke,[k(h)?(s(),C("div",we,[q("h3",null,B(((K=(H=e.contentConfig)==null?void 0:H.header)==null?void 0:K.title)??"数据列表"),1),(J=(W=e.contentConfig)==null?void 0:W.header)!=null&&J.btnTitle?(s(),u(c,{key:0,type:"primary",onClick:E},{default:r(()=>{var i,f;return[b(B(((f=(i=e.contentConfig)==null?void 0:i.header)==null?void 0:f.btnTitle)??"新建数据"),1)]}),_:1})):_("",!0)])):_("",!0),q("div",De,[S(Q,z({data:k(m),border:"",style:{width:"100%"}},e.contentConfig.childrenTree),{default:r(()=>[(s(!0),C($,null,G(e.contentConfig.propsList,i=>(s(),C($,{key:i.prop},[i.type==="timer"?(s(),u(V,z({key:0},i,{align:"center"}),{default:r(f=>[b(B(k(re)(f.row[i.prop])),1)]),_:2},1040)):i.type==="enable"?(s(),u(V,z({key:1,align:"center"},i),{default:r(f=>[S(c,{class:"enable",type:f.row.enable?"success":"danger",plain:"",size:"small"},{default:r(()=>[b(B(f.row.enable?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:2},1040)):i.type==="handler"?(s(),C($,{key:2},[k(y)||k(l)?(s(),u(V,z({key:0,align:"center"},i),{default:r(f=>[k(y)?(s(),u(c,{key:0,type:"primary",size:"small",icon:"Edit",text:"",onClick:te=>I(f.row)},{default:r(()=>[b(" 编辑 ")]),_:2},1032,["onClick"])):_("",!0),k(l)?(s(),u(c,{key:1,type:"danger",size:"small",icon:"Delete",text:"",onClick:te=>M(f.row.id)},{default:r(()=>[b(" 删除 ")]),_:2},1032,["onClick"])):_("",!0)]),_:2},1040)):_("",!0)],64)):i.type==="custom"?(s(),u(V,z({key:3,align:"center"},i),{default:r(f=>[X(p.$slots,i.slotName,le(ie(f)),void 0,!0)]),_:2},1040)):(s(),u(V,z({key:4,"show-overflow-tooltip":"",align:"center"},i),null,16))],64))),128))]),_:3},16,["data"])]),d.value??!0?(s(),C("div",Pe,[S(ee,{"current-page":A.value,"onUpdate:currentPage":o[0]||(o[0]=i=>A.value=i),"page-size":U.value,"onUpdate:pageSize":o[1]||(o[1]=i=>U.value=i),"page-sizes":[10,20,30],layout:"total,sizes, prev, pager, next, jumper",total:k(v),onSizeChange:N,onCurrentChange:T},null,8,["current-page","page-size","total"])])):_("",!0)])}}});const ze=Y(be,[["__scopeId","data-v-65479579"]]);function Se(){const e=w();return{contentRef:e,handleQueryClick:a=>{var h;(h=e.value)==null||h.fetchPageListDate(a)},handleResetClick:()=>{var a;(a=e.value)==null||a.fetchPageListDate()}}}function $e(e,t){const n=w();return{modalRef:n,handleEditClick:l=>{var y;(y=n.value)==null||y.setModelVisible(!1,l),e&&e(l)},handleNewClick:()=>{var l;(l=n.value)==null||l.setModelVisible(),t&&t()},newCallback:t}}export{$e as a,Ve as b,x as c,ze as p,Se as u};
